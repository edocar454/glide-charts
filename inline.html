<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Inline Chart</title>

<!-- Load Highcharts -->
<script src="https://code.highcharts.com/highcharts.js"></script>

<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #fff;
    font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
  }
  #container {
    width: 100%;
    height: 420px;
  }
</style>
</head>
<body>
<div id="container"></div>

<script>
(function() {
  // ✅ Robust Base64URL → JSON decoder (handles UTF-8 safely)
  function decodeBase64Url(str) {
    if (!str) return null;
    try {
      str = str.replace(/-/g, '+').replace(/_/g, '/');
      const pad = str.length % 4;
      if (pad) str += '='.repeat(4 - pad);
      const binary = atob(str);
      const bytes = new Uint8Array(binary.length);
      for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
      const jsonText = new TextDecoder().decode(bytes);
      return JSON.parse(jsonText);
    } catch (e) {
      console.error("❌ Decode error:", e);
      return null;
    }
  }

  // Get ?spec=... parameter
  const params = new URLSearchParams(window.location.search);
  const specParam = params.get('spec');
  const config = decodeBase64Url(specParam);

  // If decoding failed, show fallback
  if (!config) {
    Highcharts.chart('container', {
      title: { text: 'No or invalid chart data' },
      series: [{ data: [1, 2, 3] }]
    });
    return;
  }

  // ✅ Render chart
  Highcharts.chart('container', config);
})();
</script>
</body>
</html>
